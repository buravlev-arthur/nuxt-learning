# Режимы рендеринга

_Nuxt 3_ поддерживет следующие виды рендеринга:

- Изоморфный (universal) рендеринг;

- Рендеринг классического SPA;

- Гибридный рендеринг (уникальный режим рендеринга для каждой страницы);

- Рендеринг для CDN и Serverless провайдеров (с помощью пресетов).

## Изоморфный рендеринг

Когда браузер посылает запрос, _Nuxt_ исполняет JavaScript (Vue.js) код на сервере, генерирует HTML-страницу (HTML может быть уже обработан ранее, тогда он извлекается из кэша) и возвращает её браузеру. Это в чистом виде _SSR (Server Side Rendering)_.

Далее браузер (клиент) скачивает (в фоновом режиме) с сервера JavaScript код (Vue.js) и исполняет его уже на стороне клиента, добавляя интерактивность. Здесь уже работает принцип классических приложений _SPA (Single Page Application)_.

Процесс преобразования скаченной ранее статической HTML-страницы в интерактивный интерфейс называется _гидратацией (hydration)_.

**Преимущества**: мы получаем быструю загрузку страницы с сохранением преимуществ SPA. Так как HTML загружается сразу, поисковые машины могут просматриваеть его при обходе сайта.

**Недостатки**: увеличение нагрузки на сервер (рендеринг первых страниц для клиентов) и различия в JavaScript API для клиента и сервера. _Nuxt_ предоставляет руководства и переменные для определения, где какой код исполнять. Но нужно следить, чтобы библиотеки, использующие API браузера и имеющие side-эффекты, исполнялись только на стороне клиента.

## Рендеринг на стороне клиента

Классическое Vue.js приложение скачивает пустой HTML-файл (содерщащий корневой тег-контейнер для генерации интерфейса внутри него), а также весь необходимый JavaScript, исполняет его на стороне клиента (в браузере) и отрисовывает приложение.

**Преимущества**: дешевле (нужен обычный хостинг для статических ресурсов), удобней разрабатывать (можно полностью полагаться на API браузера), а при потере соединения приложение продолжает откликаться на действия пользователя.

**Недостатки**: снижение производительности (уходит время на загрузку всего приложения и его исполнение), увеличение времени на индексацию и обновление данных в поиковых системах.

Включить рендеринг на стороне клиента:

```typescript
// nuxt.config.js
export default defineNuxtConfig({
  ssr: false
})
```

Страницу с индикатором загрузки приложения нужно размещать здесь: `~/app/spa-loading-template.html`.

## Гибридный рендеринг

Гибридный рендеринг с помощью определения правил в объекте `routeRules` в `nuxt.config.ts` позволяет определить правила кэширования страниц и способ рендеринга (например, основные страницы сайта - _Universal rendering_, а панель администратора - _CSR_). 

```typescript
export default defineNuxtConfig({
    routeRules: {
        '/posts/**': {
            // перенаправление на другую страницу
            redirect: '/new-page',
            // режим SPA (отключение SSR)
            ssr: false,
            // добавить заголовки CORS (можно переопределить в headers)
            cors: true,
            // добавление/переопределение HTTP-заголовков
            headers: {
                'Content-Type', 'application/json',
            },
            // кэшировать на сервере ответ на один час
            // затем регенерировать страницу в фоновом режиме
            swr: 3600,
            // кэшировать страницу на сервере до следующего деплоя
            swr: true,
            // тоже самое, что и swr, только используется кэш CDN-серверов
            // сейчас поддерживают: Netlify и Vercel
            isr: true,
            // статический html-генерируется при сборке проекта,
            // а не при каждом запросе (prerender: false, по-умолчанию)
            prerender: true,
            // отключает рендеринг Nuxt-скриптов и JS-сообщений в консоли
            experimentalNoScripts: true,
        }
    }
})
```

## Рендеринг в CDN-сетях (Edge-side Rendering)

_ESR (Edge-Side Rendering)_ позволяет доставлять данные приложения быстрее за счёт выбора наиблежайшего сервера CDN-провайдера (например, Versel или Netlify, которые единственные поддерживат _Гибридный рендеринг_).

Для размещения Nuxt-приложения в CDN-сетях, нужно использовать соответствующие пресеты при сборке. Например для Versel это будет выглядить так:

```bash
# в корне приложения
NITRO_PRESET=vercel-edge bunx nuxt build
```
